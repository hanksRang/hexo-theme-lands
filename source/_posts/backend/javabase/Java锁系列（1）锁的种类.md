---
title: Java锁系列（1）锁的种类
date: 2022-02-28 19:25:29
category:
- backend
- javabase
tags: 锁
---


<font size=4>
Java锁的种类大致包括：乐观锁 / 悲观锁，独享锁 / 共享锁，互斥锁 / 读写锁，公平锁 / 非公平锁，偏向锁 / 轻量级锁 / 重量级锁，内置锁 / 显示锁，可重入锁，分段锁，偏向锁，自旋锁。以上这些锁名词，并非都是真正意义上的锁，有的只是锁的某个属性或描述。
</font>

### 1、乐观锁 / 悲观锁
这两个名词，是对两类锁的描述。乐观锁，顾名思义，就是这种锁是乐观的，悲观锁则刚好相反。
+ 乐观锁认为并发不存在或很少，每次去拿数据的时候，没有其他线程正在修改数据，不会对代码或数据上锁。但这种假设显然是有问题的，因为不能避免并发的发生。A线程拿到的数据，可能在执行更新操作时，已经被B线程更新过了，此时就问题就出现了，需要解决问题。Java中的AtomicInteger便是采用这种方式来解决并发问题，保证操作的原子性。
总结：乐观锁是等问题出现了再解决。

+ 悲观锁认为并发总是存在，每次去拿数据或执行相关代码之前都先上锁。Synchronized便是一种悲观锁。
总结：悲观锁避免问题的出现。

### 2、独享锁 / 共享锁
独享锁只能被一个线程持有，共享锁可以被多个线程同时持有。ReentrantLock是独享锁。ReentrantReadWriteLock的写锁是独享锁，读锁是共享锁，读锁和写锁互为互斥锁，即读的时候可以读，读的时候不能写，写的时候不能读，写的时候也不能写。

### 3、互斥锁
2中将的ReentrantReadWriteLock的写锁和读锁就是一对互斥锁。

### 4、公平锁 / 非公平锁
虽说是公平，但也做不到绝对公平。公平锁是指线程按照申请锁的顺序来获取锁。如可通过构造函数来指定锁是否公平，new ReentrantReadWriteLock(true); ReentrantReadWriteLock默认情况下是非公平锁。

### 5、偏向锁 / 轻量级锁 / 重量级锁
这三个名词是锁的三种状态，如synchronized锁升级过程，从偏向锁升级到轻量级锁再到重量级锁。
+ 偏向锁指当一段同步代码一致被同一个线程访问，那么该线程后续访问会自动获得锁锁。
+ 轻量级锁指当锁是偏向锁状态时，发生了两个线程竞争的情况，此时偏向锁升级为轻量级锁。轻量级锁表现为，未获代码执行权的线程通过自旋（循环执行`do{} while();`）语句来获取同步块的执行权。此时线程状态并未切换为阻塞状态。
+ 重量级锁指当有线程获取锁后，其他竞争线程会进入阻塞状态。

### 6、内置锁 / 显示锁
内置锁又名隐式锁，线程获取锁和释放锁都是隐士的，进入同步代码块即获得锁，执行完同步代码块就释放锁，如synchronized锁关键字。显示锁，需要显示实例化使用，如`ReentrantLock lock = new ReentrantLock();`。显示锁和隐式锁的区别如下：
+ 锁释放区别：显示锁需要调用unlock方法，隐式锁不用。
+ 公平性区别：显示锁可以指定公平策略，而隐式锁则默认非公平且不可改变。
+ 可否申请中断区别：使用显示锁的线程可在执行同步代码期间执行中断操作，而使用隐式锁的线程则不可。
+ 唤醒线程的区别：显示锁可精确唤醒指定线程，而隐式锁不可以。


### 7、自旋锁
自旋锁指线程在获取锁失败的情况下尝试自我循环来获取锁，并不立即进入阻塞状态。
